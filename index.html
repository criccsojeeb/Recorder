<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CriccSojeeb Stream Recorder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body {
  background:#0f172a;
  color:#fff;
  font-family: Arial, sans-serif;
  text-align:center;
  padding:20px;
}
input, button {
  padding:10px;
  margin:5px;
  border-radius:6px;
  border:none;
}
button {
  background:#22c55e;
  color:#000;
  font-weight:bold;
}
video {
  width:100%;
  max-width:720px;
  margin-top:15px;
  background:#000;
}
#timer {
  margin-top:10px;
  font-size:18px;
}

/* Watermark */
#watermark {
  position:absolute;
  top:10px;
  right:10px;
  font-weight:bold;
  font-size:20px;
  animation: glow 2s infinite alternate;
  pointer-events:none;
}
@keyframes glow {
  from {opacity:0.4;}
  to {opacity:1;}
}

/* Telegram popup */
#popup {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.8);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
}
#popup div {
  background:#020617;
  padding:20px;
  border-radius:10px;
}
</style>
</head>

<body>

<div id="popup">
  <div>
    <h2>Join Telegram First</h2>
    <a href="https://t.me/CriccSojeeb" target="_blank">
      <button>Join @CriccSojeeb</button>
    </a><br><br>
    <button onclick="closePopup()">Continue</button>
  </div>
</div>

<h1>CriccSojeeb Stream Recorder</h1>

<input id="url" placeholder="Paste m3u8 link here" size="40"><br>
<button onclick="loadStream()">Play</button>
<button onclick="startRec()">Record</button>
<button onclick="stopRec()">Stop</button>

<div id="timer">00:00</div>

<div style="position:relative; display:inline-block;">
  <video id="video" controls autoplay playsinline></video>
  <div id="watermark">CriccSojeeb</div>
</div>

<script>
let mediaRecorder;
let chunks = [];
let startTime;
let timerInt;

function closePopup(){
  document.getElementById("popup").style.display="none";
}

function loadStream(){
  const video = document.getElementById("video");
  const url = document.getElementById("url").value;

  if(Hls.isSupported()){
    const hls = new Hls({
      maxBufferLength: 30,
      maxMaxBufferLength: 60,
      lowLatencyMode: false
    });
    hls.loadSource(url);
    hls.attachMedia(video);
  } else {
    video.src = url;
  }
}

function startRec(){
  chunks=[];
  const stream = document.getElementById("video").captureStream(60);

  mediaRecorder = new MediaRecorder(stream, {
    mimeType: 'video/webm;codecs=vp9',
    videoBitsPerSecond: 8000000
  });

  mediaRecorder.ondataavailable = e => chunks.push(e.data);

  mediaRecorder.onstop = () => {
    const blob = new Blob(chunks, {type:'video/webm'});
    const a = document.createElement("a");
    const name = "CriccSojeeb_" + Date.now() + ".webm";
    a.href = URL.createObjectURL(blob);
    a.download = name;
    a.click();
  };

  mediaRecorder.start();
  startTimer();
}

function stopRec(){
  if(mediaRecorder) mediaRecorder.stop();
  stopTimer();
}

function startTimer(){
  startTime = Date.now();
  timerInt = setInterval(()=>{
    let diff = Math.floor((Date.now()-startTime)/1000);
    let m = String(Math.floor(diff/60)).padStart(2,'0');
    let s = String(diff%60).padStart(2,'0');
    document.getElementById("timer").innerText = `${m}:${s}`;
  },1000);
}
function stopTimer(){
  clearInterval(timerInt);
}
</script>

</body>
</html>
