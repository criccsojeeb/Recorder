<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CriccSojeeb Stream Recorder</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: Arial, sans-serif;
  text-align: center;
}

video {
  width: 100%;
  max-height: 60vh;
  background: #000;
}

/* Watermark */
#watermark {
  position: fixed;
  top: 10px;
  right: 10px;
  font-size: 22px;
  font-weight: bold;
  animation: pulse 2s infinite;
  opacity: 0.8;
  z-index: 999;
}
@keyframes pulse {
  0% { text-shadow: 0 0 5px red; }
  100% { text-shadow: 0 0 15px yellow; }
}

/* Buttons */
button {
  padding: 10px 15px;
  margin: 5px;
  font-size: 16px;
  cursor: pointer;
}

#timer {
  font-size: 18px;
  color: #0f0;
  margin-top: 5px;
}

/* Telegram Popup */
#popup {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}
#popup div {
  background: #111;
  padding: 20px;
  border-radius: 10px;
}
#popup a {
  display: block;
  margin-top: 10px;
  background: #0088cc;
  color: #fff;
  padding: 10px;
  text-decoration: none;
  border-radius: 5px;
}

/* Bottom Join */
#bottomJoin {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: #0088cc;
  padding: 10px;
}
#bottomJoin a {
  color: #fff;
  font-weight: bold;
  text-decoration: none;
}
</style>
</head>

<body>

<!-- Telegram Popup -->
<div id="popup">
  <div>
    <h3>Join Our Telegram</h3>
    <a href="https://t.me/CriccSojeeb" target="_blank">Join @CriccSojeeb</a>
    <button onclick="closePopup()">Continue</button>
  </div>
</div>

<div id="watermark">CriccSojeeb</div>

<h2>CriccSojeeb Stream Recorder</h2>

<input id="m3u8" placeholder="Paste m3u8 link here" style="width:90%">
<br>
<button onclick="loadStream()">▶ Play Stream</button>

<video id="video" controls playsinline></video>

<div>
  <button onclick="startRecord()">⏺ Start Record</button>
  <button onclick="stopRecord()">⏹ Stop Record</button>
</div>

<div id="timer">00:00</div>

<div id="bottomJoin">
  <a href="https://t.me/CriccSojeeb" target="_blank">Join Telegram @CriccSojeeb</a>
</div>

<script>
/* Player */
let hls;
function loadStream() {
  const video = document.getElementById('video');
  const url = m3u8.value.trim();

  if (Hls.isSupported()) {
    hls = new Hls({
      enableWorker: true,
      lowLatencyMode: false
    });
    hls.loadSource(url);
    hls.attachMedia(video);
  } else {
    video.src = url;
  }
}

/* Recorder */
let recorder, chunks = [];
let seconds = 0, timerInt;

function startRecord() {
  const stream = video.captureStream();
  recorder = new MediaRecorder(stream, {
    mimeType: 'video/webm;codecs=vp9',
    videoBitsPerSecond: 6000000,
    audioBitsPerSecond: 192000
  });

  recorder.ondataavailable = e => chunks.push(e.data);
  recorder.onstop = saveVideo;

  recorder.start();
  seconds = 0;
  timerInt = setInterval(updateTimer, 1000);
}

function stopRecord() {
  if (recorder) recorder.stop();
  clearInterval(timerInt);
}

function updateTimer() {
  seconds++;
  const m = String(Math.floor(seconds / 60)).padStart(2, '0');
  const s = String(seconds % 60).padStart(2, '0');
  timer.innerText = `${m}:${s}`;
}

function saveVideo() {
  const blob = new Blob(chunks, { type: 'video/webm' });
  chunks = [];
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `CriccSojeeb_${new Date().toISOString().replace(/[:.]/g,'-')}.webm`;
  a.click();
}

/* Popup */
function closePopup() {
  popup.style.display = "none";
}
</script>

</body>
</html>
